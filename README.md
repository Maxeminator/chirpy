# üê¶ Chirpy ‚Äî REST API

Chirpy ‚Äî —ç—Ç–æ Twitter-–ø–æ–¥–æ–±–Ω–æ–µ API-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–µ –Ω–∞ Go. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –ø—É–±–ª–∏–∫–∞—Ü–∏—é —á–∏—Ä–ø–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –ø–æ–¥–ø–∏—Å–∫—É Chirpy Red —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫.

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Go 1.22+
- PostgreSQL
- –§–∞–π–ª `.env` —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
  ```
  DB_URL=postgres://<username>:<password>@localhost:5432/<dbname>?sslmode=disable
  JWT_SECRET=your_jwt_secret
  POLKA_KEY=your_polka_API_key
  PLATFORM=dev
  ```

### –ó–∞–ø—É—Å–∫
```
go run main.go
```

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

- –î–ª—è –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤: `Authorization: Bearer <JWT>`
- –î–ª—è –≤–µ–±—Ö—É–∫–æ–≤: `Authorization: ApiKey <POLKA_KEY>`

## üîß API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

#### `POST /api/users`
–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```json
{
  "email": "user@example.com",
  "password": "supersecret",
  "expires_in_seconds": 3600
}
```

#### `POST /api/login`
–õ–æ–≥–∏–Ω:
```json
{
  "email": "user@example.com",
  "password": "supersecret"
}
```
–û—Ç–≤–µ—Ç:
```json
{
  "id": "uuid",
  "email": "user@example.com",
  "token": "JWT",
  "refresh_token": "REFRESH_TOKEN",
  "is_chirpy_red": false
}
```

#### `POST /api/refresh`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access-—Ç–æ–∫–µ–Ω–∞  
–¢—Ä–µ–±—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫: `Authorization: Bearer <refresh_token>`

#### `POST /api/revoke`
–û—Ç–∑—ã–≤ refresh-—Ç–æ–∫–µ–Ω–∞  
–¢—Ä–µ–±—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫: `Authorization: Bearer <refresh_token>`

#### `PUT /api/users`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ email –∏ –ø–∞—Ä–æ–ª—è:
```json
{
  "email": "new@example.com",
  "password": "newpassword"
}
```

### üê¶ –ß–∏—Ä–ø—ã

#### `POST /api/chirps`
–°–æ–∑–¥–∞–Ω–∏–µ —á–∏—Ä–ø–∞:
```json
{
  "body": "Hello, Chirpy!"
}
```
–ú–∞–∫—Å–∏–º—É–º 140 —Å–∏–º–≤–æ–ª–æ–≤. –ó–∞–ø—Ä–µ—â–µ–Ω—ã —Å–ª–æ–≤–∞: kerfuffle, sharbert, fornax.

### üìò `GET /api/chirps`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∏—Ä–ø–æ–≤.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (Query Parameters):**

| –ü–∞—Ä–∞–º–µ—Ç—Ä     | –¢–∏–ø             | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 |
|--------------|------------------|--------------------------------------------------------------------------|
| `author_id`  | `string` (UUID)  | (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) –í–µ—Ä–Ω—ë—Ç —Ç–æ–ª—å–∫–æ —á–∏—Ä–ø—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —ç—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º       |
| `sort`       | `string`         | (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è. <br>–î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: <br> - `asc` (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)<br> - `desc` (–ø–æ —É–±—ã–≤–∞–Ω–∏—é) |

**–ü—Ä–∏–º–µ—Ä—ã:**

```http
GET /api/chirps
GET /api/chirps?sort=desc
GET /api/chirps?author_id=123e4567-e89b-12d3-a456-426614174000&sort=asc

#### `GET /api/chirps/{chirpID}`
–ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω —á–∏—Ä–ø –ø–æ ID.

#### `DELETE /api/chirps/{chirpID}`
–£–¥–∞–ª–∏—Ç—å —á–∏—Ä–ø (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –∞–≤—Ç–æ—Ä).

### üí≥ –í–µ–±—Ö—É–∫–∏ Polka

#### `POST /api/polka/webhooks`

–ó–∞–≥–æ–ª–æ–≤–æ–∫:
```
Authorization: ApiKey f271c81ff7084ee5b99a5091b42d486e
```

–¢–µ–ª–æ:
```json
{
  "event": "user.upgraded",
  "data": {
    "user_id": "uuid"
  }
}
```

–û—Ç–≤–µ—Ç—ã:
- `204` ‚Äî –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ –∏–ª–∏ —Å–æ–±—ã—Ç–∏–µ –Ω–µ–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ
- `401` ‚Äî –µ—Å–ª–∏ API-–∫–ª—é—á –Ω–µ–≤–µ—Ä–µ–Ω
- `404` ‚Äî –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/chirpy
‚îú‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îî‚îÄ‚îÄ database/
‚îú‚îÄ‚îÄ queries/
‚îÇ   ‚îú‚îÄ‚îÄ chirps.sql
‚îÇ   ‚îî‚îÄ‚îÄ users.sql
‚îú‚îÄ‚îÄ .env
‚îî‚îÄ‚îÄ README.md
```
## ‚úÖ –¢–µ—Å—Ç—ã

```
go test ./...
```
